# XQPath v1.4.1 调试能力实施计划

## 🎯 版本目标
建立基础的日志系统和调试能力，为用户和开发者提供更好的问题诊断工具。

## 📦 新增功能

### 1. 结构化日志系统
```toml
# Cargo.toml 新增依赖
[dependencies]
tracing = "0.1"
tracing-subscriber = { version = "0.3", features = ["env-filter", "json"] }
tracing-appender = "0.2"
```

**实现模块：**
- `src/logging.rs` - 日志配置和初始化
- `src/debug.rs` - 调试工具函数

### 2. CLI 调试选项增强
```bash
# 新增CLI参数
xqpath get '.data' --debug                    # 开启调试模式
xqpath get '.data' --log-level info          # 设置日志级别 
xqpath get '.data' --log-file debug.log      # 输出到文件
xqpath get '.data' --timing                  # 显示执行时间
```

### 3. 错误诊断改进
- 🎯 **精确错误定位**：显示表达式中错误的具体位置
- 💡 **修复建议**：自动分析常见错误并提供解决方案
- 📊 **错误分类**：将错误按类型分类，便于理解

### 4. 基础性能监控
- ⏱️ **执行时间统计**：解析、求值、格式化各阶段耗时
- 💾 **内存使用提示**：大数据处理时的内存占用警告

## 🛠️ 实施任务

### Week 1: 日志系统基础架构
- [ ] 创建 `src/logging.rs` 模块
- [ ] 实现多级日志输出（TRACE/DEBUG/INFO/WARN/ERROR）
- [ ] 支持控制台和文件输出
- [ ] 在CLI中集成日志选项

### Week 2: 调试功能增强
- [ ] 创建 `src/debug.rs` 调试工具模块
- [ ] 实现表达式错误精确定位
- [ ] 添加常见错误的修复建议系统
- [ ] 实现基础的执行时间统计

### Week 3: 测试和文档
- [ ] 为新功能编写单元测试
- [ ] 更新CLI帮助文档和README
- [ ] 创建调试使用指南
- [ ] 进行集成测试和性能验证

## 📋 验收标准
- ✅ 所有CLI命令支持 `--debug` 和 `--log-level` 参数
- ✅ 错误信息包含精确位置和修复建议
- ✅ 日志可以输出到文件且格式化良好
- ✅ 执行时间统计准确（精度到毫秒）
- ✅ 所有现有测试继续通过
- ✅ 新增至少20个调试相关的测试用例

## 🎁 用户收益
- 🐛 **更快定位问题**：错误信息更详细和准确
- 🔍 **更好的调试体验**：实时查看程序执行过程
- 📊 **性能意识**：了解查询的执行效率
- 📝 **完整的执行记录**：可追溯的日志文件
